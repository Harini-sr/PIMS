<!-- Navigation -->
<app-nav-admin></app-nav-admin>

<div class="container-fluid mt-2">
  <div class="row">
    <div class="col-md-5">
      <h3 class="text-center text-success">All Issues</h3>
    </div>
<!-- Date filter -->
    <div class="col-md-1">
      <button class="btn btn-success">
        <a class="text-decoration-none text-white" routerLink="/issue-form">Add Issue</a>
      </button>
    </div>
  <div class="col-md-2">
      <div class="input-group">
        <span class="input-group-text bg-success text-white">Date</span>
        <input
          type="date"
          class="form-control"
          [(ngModel)]="selectedDate"
          (change)="applyFilters()"
        />
      </div>
    </div>
<!--  Search Filter -->
    <div class="col-md-3">
      <div class="input-group">
        <span class="input-group-text bg-success text-white">Search</span>
        <input
          type="search"
          class="form-control"
          [(ngModel)]="searchTerm"
          (input)="applyFilters()"
          placeholder="Search issue..."
        />
      </div>
    </div>
  </div>
</div>


<!-- Issues Table -->
<div class="container-fluid bg-light mt-4">
  <div class="container p-5">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 w-100">
      <!-- ID -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let element">{{ element.id }}</td>
      </ng-container>

      <!-- Name -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let element">{{ element.name }}</td>
      </ng-container>

      <!-- Email -->
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>Email</th>
        <td mat-cell *matCellDef="let element">{{ element.email }}</td>
      </ng-container>

      <!-- Date -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>Date</th>
        <td mat-cell *matCellDef="let element">{{ element.date | date: 'dd-MM-yyyy' }}</td>
      </ng-container>

      <!-- Issue Type -->
      <ng-container matColumnDef="issueType">
        <th mat-header-cell *matHeaderCellDef>Issue Type</th>
        <td mat-cell *matCellDef="let element">{{ element.issueType }}</td>
      </ng-container>

      <!-- Description -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let element">{{ element.description }}</td>
      </ng-container>

      <!-- Location -->
      <ng-container matColumnDef="location">
        <th mat-header-cell *matHeaderCellDef>Location</th>
        <td mat-cell *matCellDef="let element">{{ element.location }}</td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let element">
          <span
            class="badge px-3 py-2 rounded-pill"
            [ngClass]="{
              'bg-success': element.status === 'closed',
              'bg-warning text-dark': element.status === 'in-progress',
              'bg-danger': element.status === 'open'
            }"
            (click)="cycleStatus(element)"
            style="cursor: pointer"
            title="Click to change status"
          >
            {{
              element.status === 'closed'
                ? 'Completed'
                : element.status === 'in-progress'
                ? 'In Progress'
                : 'Pending'
            }}
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <!--  Pagination -->
    <mat-card-footer>
      <div class="row d-flex justify-content-end mt-3 mx-2">
        <div class="col-md-7"></div>
        <div class="col-md-5 text-end">
          <button class="btn btn-success me-2">Total Entries: {{ totalEntries }}</button>

          <button
            class="btn btn-success me-2"
            (click)="changePageIndex(pageIndex - 1)"
            [disabled]="pageIndex === 0"> Previous</button>

          <button class="btn btn-success me-2">
            Page {{ currentPage }} of {{ totalPages }}
          </button>

          <button
            class="btn btn-success"
            (click)="changePageIndex(pageIndex + 1)"
            [disabled]="pageIndex >= totalPages - 1" > Next</button>
        </div>
      </div>
    </mat-card-footer>
  </div>
</div>
